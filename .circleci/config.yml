version: 2

jobs:

    test:
        docker:
            - image: circleci/python:3.8
        steps:
            - checkout
            - run: |
                pip install --user tox
                tox -vv

    test-w-telemetry:
        docker:
            - image: circleci/python:3.8
        steps:
            - checkout
            - run: |
                pip install --user tox wipac-telemetry
                tox -vv

    integrate-w-telemetry:
        docker:
            - image: circleci/python:3.8
        steps:
            - checkout
            - run: |
                pip install --user tox wipac-telemetry
                tox --notest -vv
                . .tox/py/bin/activate
                cd tests/integrate/
                ./run_client_server.sh


    pycycle:
        docker:
            - image: circleci/python:3.8
        steps:
            - checkout
            - run: |
                pip install --user tox pycycle
                tox --notest -vv
                . .tox/py/bin/activate
                pycycle --here --verbose


workflows:
    version: 2
    build_and_test:
        jobs:
            - test
            - test-w-telemetry
            - integrate-w-telemetry
            - pycycle
